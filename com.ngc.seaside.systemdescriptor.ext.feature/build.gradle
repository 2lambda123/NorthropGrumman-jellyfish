ext {
   buildDir = 'build'
}

configurations {
   feature
}

task clean() {
   doLast {
      delete("$buildDir")
   }
}

task copyAndFilterFeatureFile(type: Copy) {
   from 'src/main/resources', { include('feature.xml') }
   destinationDir = file("$buildDir/tmp")

   filter { String line ->
      if (line.trim() == 'version="${project.version}"') {
         def formattedVersion = "$project.version".replace('-', '.')
         line = "version=\"$formattedVersion\""
      }
      return line
   }
}

task createJar(type: Zip, dependsOn: [copyAndFilterFeatureFile]) {
   from "$buildDir/tmp"
   destinationDir = file("$buildDir")
   archiveName = "${project.group}.${project.name}-${project.version}.jar"
}

task build(dependsOn: createJar) {
}

artifacts {
   feature createJar
}

defaultTasks = ['build']
